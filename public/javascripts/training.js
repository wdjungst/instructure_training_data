// Generated by CoffeeScript 1.4.0
(function() {

  $(function() {
    var all_users, arrayOfData, colors, graphData, graphInfo, listItemClickHandler, populate_data, usersClickHandler, week, weekClickHandler, weeks, _i, _len;
    arrayOfData = [];
    colors = ['#FF3300', '#FF6633', '#33FF33', '#0000CC', '#00CCCC', '#9966CC', '#FFFF00', '#FF9933', '#003300', '#3399FF', '#33CC33', '#CC0000', '#66FF66', '#3399FF', '#660066', '#99FFFF', '#99FF33', '#FF6666', '#00CC99', '#FFFF99'];
    all_users = '';
    graphData = [];
    graphInfo = function(userInfo) {
      var el, number, plot, _i, _len;
      graphData = [];
      for (_i = 0, _len = userInfo.length; _i < _len; _i++) {
        el = userInfo[_i];
        number = parseInt(el);
        graphData.push(number);
      }
      plot = $.jqplot("chartdiv", [graphData], {
        title: "Summary",
        axesDefaults: {
          labelRenderer: $.jqplot.CanvasAxisLabelRenderer,
          tickRenderer: $.jqplot.CanvasAxisTickRenderer,
          tickOptions: {
            angle: -30,
            fotSize: '10pt',
            mark: 'cross'
          }
        },
        axes: {
          xaxis: {
            renderer: $.jqplot.CategoryAxisRenderer,
            ticks: ['Week 1', 'Week 2', 'Week 3', 'Week 4', 'Week 5', 'Week 6', 'Week 7', 'Week 8'],
            pad: 0
          },
          yaxis: {
            tickInterval: 1,
            tickOptions: {
              formatString: '%d'
            },
            label: "Suggestions",
            min: 0
          }
        },
        highlighter: {
          show: true,
          tooltipAxes: 'y',
          sizeAdjust: 7.5
        }
      });
      return plot.replot();
    };
    listItemClickHandler = function() {
      return $("[id^='list_item']").bind('click', function(e) {
        var name;
        name = $(this).text();
        $('#user-label').text(name);
        return $.get("/user_info/" + name, function(data) {
          return graphInfo(data.split(","));
        });
      });
    };
    populate_data = function(users, id) {
      var $userDropdown, a, array, el, index, name, number, temp, _i, _len;
      arrayOfData = [];
      array = users.split('~');
      $userDropdown = $(id);
      $userDropdown.empty();
      for (index = _i = 0, _len = array.length; _i < _len; index = ++_i) {
        el = array[index];
        a = el.split(',');
        name = a[1];
        if (typeof name !== "undefined") {
          $userDropdown.append("<li><a href='#' id='list_item_" + index + "'>" + name + "</a></li>");
        }
        number = parseFloat(a[0]);
        temp = [];
        temp.push(number);
        temp.push(a[1]);
        temp.push(colors[index]);
        arrayOfData.push(temp);
      }
      arrayOfData.pop();
      listItemClickHandler();
      $(".graph-container").empty();
      return $(".graph-container").jqBarGraph({
        data: arrayOfData,
        legend: true,
        legendWidth: 200,
        sort: 'desc',
        width: '900px'
      });
    };
    weeks = ['0', '1', '2', '3', '4', '5', '6', '7', '8'];
    weekClickHandler = function(week) {
      return $("#week" + week).bind('click', function(e) {
        $('.graph-container').empty();
        e.preventDefault();
        return $.get("/week/" + week, function(data) {
          return populate_data(data, '#user_dropdown');
        });
      });
    };
    usersClickHandler = function() {
      return $('#modal-btn').bind('click', function(e) {
        return $('#users-modal').modal('show');
      });
    };
    usersClickHandler();
    for (_i = 0, _len = weeks.length; _i < _len; _i++) {
      week = weeks[_i];
      weekClickHandler(week);
    }
    $('#users-modal').on("shown", function() {
      return populate_data(all_users, '#modal_dropdown');
    });
    return $.get("/all_posts", function(response) {
      all_users = response;
      return populate_data(response, '#user_dropdown');
    });
  });

}).call(this);
